{"ast":null,"code":"'use strict';\n\nconst {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kGetDispatcher\n} = require('./pool-base');\nconst Client = require('./client');\nconst {\n  InvalidArgumentError\n} = require('./core/errors');\nconst util = require('./core/util');\nconst {\n  kUrl,\n  kInterceptors\n} = require('./core/symbols');\nconst buildConnector = require('./core/connect');\nconst kOptions = Symbol('options');\nconst kConnections = Symbol('connections');\nconst kFactory = Symbol('factory');\nfunction defaultFactory(origin, opts) {\n  return new Client(origin, opts);\n}\nclass Pool extends PoolBase {\n  constructor(origin) {\n    let {\n      connections,\n      factory = defaultFactory,\n      connect,\n      connectTimeout,\n      tls,\n      maxCachedSessions,\n      socketPath,\n      autoSelectFamily,\n      autoSelectFamilyAttemptTimeout,\n      ...options\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n    if (connections != null && (!Number.isFinite(connections) || connections < 0)) {\n      throw new InvalidArgumentError('invalid connections');\n    }\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.');\n    }\n    if (connect != null && typeof connect !== 'function' && typeof connect !== 'object') {\n      throw new InvalidArgumentError('connect must be a function or an object');\n    }\n    if (typeof connect !== 'function') {\n      connect = buildConnector({\n        ...tls,\n        maxCachedSessions,\n        socketPath,\n        timeout: connectTimeout == null ? 10e3 : connectTimeout,\n        ...(util.nodeHasAutoSelectFamily && autoSelectFamily ? {\n          autoSelectFamily,\n          autoSelectFamilyAttemptTimeout\n        } : undefined),\n        ...connect\n      });\n    }\n    this[kInterceptors] = options.interceptors && options.interceptors.Pool && Array.isArray(options.interceptors.Pool) ? options.interceptors.Pool : [];\n    this[kConnections] = connections || null;\n    this[kUrl] = util.parseOrigin(origin);\n    this[kOptions] = {\n      ...util.deepClone(options),\n      connect\n    };\n    this[kOptions].interceptors = options.interceptors ? {\n      ...options.interceptors\n    } : undefined;\n    this[kFactory] = factory;\n  }\n  [kGetDispatcher]() {\n    let dispatcher = this[kClients].find(dispatcher => !dispatcher[kNeedDrain]);\n    if (dispatcher) {\n      return dispatcher;\n    }\n    if (!this[kConnections] || this[kClients].length < this[kConnections]) {\n      dispatcher = this[kFactory](this[kUrl], this[kOptions]);\n      this[kAddClient](dispatcher);\n    }\n    return dispatcher;\n  }\n}\nmodule.exports = Pool;","map":{"version":3,"names":["PoolBase","kClients","kNeedDrain","kAddClient","kGetDispatcher","require","Client","InvalidArgumentError","util","kUrl","kInterceptors","buildConnector","kOptions","Symbol","kConnections","kFactory","defaultFactory","origin","opts","Pool","constructor","connections","factory","connect","connectTimeout","tls","maxCachedSessions","socketPath","autoSelectFamily","autoSelectFamilyAttemptTimeout","options","arguments","length","undefined","Number","isFinite","timeout","nodeHasAutoSelectFamily","interceptors","Array","isArray","parseOrigin","deepClone","dispatcher","find","module","exports"],"sources":["/Users/aluabajzanova/Desktop/skylineÂ /node_modules/undici/lib/pool.js"],"sourcesContent":["'use strict'\n\nconst {\n  PoolBase,\n  kClients,\n  kNeedDrain,\n  kAddClient,\n  kGetDispatcher\n} = require('./pool-base')\nconst Client = require('./client')\nconst {\n  InvalidArgumentError\n} = require('./core/errors')\nconst util = require('./core/util')\nconst { kUrl, kInterceptors } = require('./core/symbols')\nconst buildConnector = require('./core/connect')\n\nconst kOptions = Symbol('options')\nconst kConnections = Symbol('connections')\nconst kFactory = Symbol('factory')\n\nfunction defaultFactory (origin, opts) {\n  return new Client(origin, opts)\n}\n\nclass Pool extends PoolBase {\n  constructor (origin, {\n    connections,\n    factory = defaultFactory,\n    connect,\n    connectTimeout,\n    tls,\n    maxCachedSessions,\n    socketPath,\n    autoSelectFamily,\n    autoSelectFamilyAttemptTimeout,\n    ...options\n  } = {}) {\n    super()\n\n    if (connections != null && (!Number.isFinite(connections) || connections < 0)) {\n      throw new InvalidArgumentError('invalid connections')\n    }\n\n    if (typeof factory !== 'function') {\n      throw new InvalidArgumentError('factory must be a function.')\n    }\n\n    if (connect != null && typeof connect !== 'function' && typeof connect !== 'object') {\n      throw new InvalidArgumentError('connect must be a function or an object')\n    }\n\n    if (typeof connect !== 'function') {\n      connect = buildConnector({\n        ...tls,\n        maxCachedSessions,\n        socketPath,\n        timeout: connectTimeout == null ? 10e3 : connectTimeout,\n        ...(util.nodeHasAutoSelectFamily && autoSelectFamily ? { autoSelectFamily, autoSelectFamilyAttemptTimeout } : undefined),\n        ...connect\n      })\n    }\n\n    this[kInterceptors] = options.interceptors && options.interceptors.Pool && Array.isArray(options.interceptors.Pool)\n      ? options.interceptors.Pool\n      : []\n    this[kConnections] = connections || null\n    this[kUrl] = util.parseOrigin(origin)\n    this[kOptions] = { ...util.deepClone(options), connect }\n    this[kOptions].interceptors = options.interceptors\n      ? { ...options.interceptors }\n      : undefined\n    this[kFactory] = factory\n  }\n\n  [kGetDispatcher] () {\n    let dispatcher = this[kClients].find(dispatcher => !dispatcher[kNeedDrain])\n\n    if (dispatcher) {\n      return dispatcher\n    }\n\n    if (!this[kConnections] || this[kClients].length < this[kConnections]) {\n      dispatcher = this[kFactory](this[kUrl], this[kOptions])\n      this[kAddClient](dispatcher)\n    }\n\n    return dispatcher\n  }\n}\n\nmodule.exports = Pool\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}